<style>
    #leaderboard-banner {
        margin-bottom: 20px;
        text-align: center;
        max-width: 100%;
    }
    #leaderboard-banner img {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto;
    }
    #leaderboard-container {
        font-size: 0.9rem;
        line-height: 1.15;
    }
    #leaderboard-container .gridjs-table {
        border-collapse: collapse;
        border: 10px solid #3b0687;
        width: 100%; /* Ensure the table uses all available space */
    }
    #leaderboard-container .gridjs-tr .gridjs-td:nth-child(3) {
        font-weight: bold;
    }
    /* --- CSS COUNTER FOR AUTO-RANKING --- */
    #leaderboard-container .gridjs-tbody {
        counter-reset: leaderboard-rank;
    }
    #leaderboard-container .gridjs-search {
    display: none;
    }
    #leaderboard-container .gridjs-tr {
        counter-increment: leaderboard-rank;
    }
    #leaderboard-container .gridjs-td:first-child::before {
        content: counter(leaderboard-rank);
    }

    /* --- COLUMN WIDTH FIXES --- */

    /* Column 1: '#' */
    #leaderboard-container .gridjs-th:first-child,
    #leaderboard-container .gridjs-td:first-child {
        text-align: center;
    }
    #leaderboard-container .gridjs-th:nth-child(3),
    #leaderboard-container .gridjs-td:nth-child(3),
    #leaderboard-container .gridjs-th:nth-child(4),
    #leaderboard-container .gridjs-td:nth-child(4),
    #leaderboard-container .gridjs-th:nth-child(5),
    #leaderboard-container .gridjs-td:nth-child(5),
    #leaderboard-container .gridjs-th:nth-child(6),
    #leaderboard-container .gridjs-td:nth-child(6) {
      width: 10% !important;
    }
    /* Apply wrapping to the long headers */
    #leaderboard-container .gridjs-th:nth-child(4) .gridjs-th-content,
    #leaderboard-container .gridjs-th:nth-child(5) .gridjs-th-content,
    #leaderboard-container .gridjs-th:nth-child(6) .gridjs-th-content {
        white-space: normal;
        word-break: break-word;
        line-height: 1.1;
        text-align: center;
    }

    /* General Cell Styling */
    #leaderboard-container .gridjs-th,
    #leaderboard-container .gridjs-td {
        border: 2px solid #3b0687;
        padding: 3px;
        text-align: center;
    }
    /* Name column aligns left */
    #leaderboard-container .gridjs-td:nth-child(2) {
        text-align: left;
    }
    #leaderboard-container .gridjs-th:nth-child(2) .gridjs-th-content {
        text-align: left;
    }

    /* Header Styling */
    #leaderboard-container .gridjs-th {
        background-color: #ff0054;
        color: #ffffff;
        vertical-align: middle;
    }

    /* Stripe rows */
    #leaderboard-container .gridjs-tr:nth-child(even) .gridjs-td {
        background-color: #ddcdf5;
    }

    /* Filter Container Styling */
    .filter-controls {
        display: flex; /* Arranges filters side-by-side */
        gap: 20px;
        margin-bottom: 15px;
        flex-wrap: wrap; /* Allows wrapping on small screens */
    }
    .search-and-filters-wrapper {
        display: flex; /* Enable flexbox for horizontal alignment */
        align-items: center; /* Vertically align items in the center */
        justify-content: flex-start; /* Move things to the start */
        margin-bottom: 15px;
        flex-wrap: wrap; /* Allow wrapping on smaller screens */
        gap: 10px; /* Space between search and filters */
    }

    /* Target the Grid.js Search box container */
    .gridjs-search {
        /* Set a max width so it doesn't consume all available space */
        max-width: 300px;
        flex-grow: 1; /* Allow it to grow, but respecting max-width */
    }

    /* Filter Container Styling (Adjusted for side-by-side) */
    .filter-controls {
        display: flex; /* Arranges filters side-by-side */
        gap: 15px; /* Reduced gap between filter dropdowns */
        margin-bottom: 0; /* No need for bottom margin here */
        flex-shrink: 0; /* Prevent filters from shrinking too much */
        flex-wrap: wrap; /* Allows wrapping on small screens */
    }
    /* Style for the Grid.js Search Input Box */
    .gridjs-search input[type='text'] {
        background-color: #663fa8 !important; /* Interior color */
        border: 2px solid #3b0687 !important; /* Exterior/Border color */
        color: white !important; /* Text color */
        /* Placeholder color for search */
        /* Note: For more consistent cross-browser placeholder color, you might need additional rules like ::placeholder, but this covers the main input text */
    }

    /* Style for the Custom Filter Dropdown Boxes (<select>) */
    .filter-controls select {
        background-color: #663fa8; /* Interior color */
        border: 2px solid #3b0687; /* Exterior/Border color */
        color: white; /* Text color */
        padding: 5px;
        border-radius: 3px;
        /* Optional: Apply same background/color to the option elements */
    }

    /* Style for the Filter Labels (Text next to the dropdowns) */
    .filter-controls label {
        color: #3b0687; /* Use the dark purple for better visibility next to the colored boxes */
        font-weight: bold;
    }
    
    /* Media Queries (Updated Font Size) */
    @media (max-width: 1200px) {
        #leaderboard-container {
            font-size: 0.65rem;
            width: auto;
        }
        #leaderboard-container .gridjs-th,
        #leaderboard-container .gridjs-td {
            line-height: 1.1;
            padding: 2px !important;
        }
    }
    @media (max-width: 768px) {
        #leaderboard-container {
            font-size: 0.6rem;
        }
        #leaderboard-container .gridjs-th:nth-child(3),
        #leaderboard-container .gridjs-td:nth-child(3) {
          width: 25% !important;
        }
        #leaderboard-container .gridjs-th:nth-child(4),
        #leaderboard-container .gridjs-td:nth-child(4),
        #leaderboard-container .gridjs-th:nth-child(5),
        #leaderboard-container .gridjs-td:nth-child(5),
        #leaderboard-container .gridjs-th:nth-child(6),
        #leaderboard-container .gridjs-td:nth-child(6),
        #leaderboard-container .gridjs-th:nth-child(8),
        #leaderboard-container .gridjs-td:nth-child(8),
        #leaderboard-container .gridjs-th:nth-child(9),
        #leaderboard-container .gridjs-td:nth-child(9) {
          display: none !important;
        }
    }
</style>
<div id="leaderboard-banner">
    <img src="https://github.com/somaek/somaek.github.io/blob/main/CLASSICS%20BANNER.png?raw=true" alt="Leaderboard Banner" />
</div>

<div class="search-and-filters-wrapper">
    <div id="gridjs-search-placeholder"></div>
    <div class="filter-controls">
        <div style="margin-bottom: 0;">
            <label for="rank-filter">   </label>
            <select id="rank-filter">
                <option value="">All Ranks</option>
            </select>
        </div>
        <div style="margin-bottom: 0;">
            <label for="age-filter">   </label>
            <select id="age-filter">
                <option value="">All Ages</option>
            </select>
        </div>
    </div>
</div>

<div id="leaderboard-container">Loading leaderboard...</div>

<link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
<script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
<script>
    let gridInstance;
    const RANK_ORDER = ['Diamond', 'Platinum', 'Gold', 'Silver', 'Bronze']; // For custom sorting the rank filter

    // --- Grid.js Column Index Reference (The data has '#' prepended) ---
    // CSV Header Index | Data Array Index | Header Name
    // 0                | 1                | Name
    // 1                | 2                | All Rounder
    // ...
    // [Rank column index] | [Rank column index] + 1 | Rank
    // [Age column index]  | [Age column index] + 1  | Age
    // -------------------------------------------------------------------

    const csvURL = 'https://raw.githubusercontent.com/somaek/somaek.github.io/refs/heads/main/classicsL.csv';

    const container = document.getElementById('leaderboard-container');
    const rankFilterSelect = document.getElementById('rank-filter');
    const ageFilterSelect = document.getElementById('age-filter'); // NEW AGE DROPDOWN

    function parseCSVRow(row) {
        const result = [];
        let current = '';
        let inQuote = false;
        for (let i = 0; i < row.length; i++) {
            const char = row[i];
            if (char === '"') {
                inQuote = !inQuote;
            } else if (char === ',' && !inQuote) {
                result.push(current.trim().replace(/^"|"$/g, ''));
                current = '';
            } else {
                current += char;
            }
        }
        result.push(current.trim().replace(/^"|"$/g, ''));
        return result;
    }

    // This function will apply the filtering based on BOTH dropdowns
    function applyCombinedFilter(allData, rankDataIndex, ageDataIndex) {
        if (!gridInstance) return;

        const selectedRank = rankFilterSelect.value;
        const selectedAge = ageFilterSelect.value; // Get the selected age

        let filteredData = allData.filter(row => {
            const rankMatch = selectedRank === "" || String(row[rankDataIndex]) === selectedRank;
            const ageMatch = selectedAge === "" || String(row[ageDataIndex]) === selectedAge; // Check age match
            return rankMatch && ageMatch; // MUST match both filters
        });

        gridInstance.updateConfig({
            data: filteredData
        }).forceRender();
    }

    fetch(csvURL)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.text();
        })
        .then(csvData => {
            const rows = csvData.trim().split(/\r\n|\r|\n/);
            const headers = parseCSVRow(rows[0]);

            const rankColumnName = 'Rank';
            const ageColumnName = 'Age'; // NEW AGE COLUMN NAME
            const defaultSortColumnName = 'All Rounder';

            const rankColumnIndex = headers.indexOf(rankColumnName);
            const ageColumnIndex = headers.indexOf(ageColumnName); // NEW AGE INDEX
            const defaultSortColumnIndex = headers.indexOf(defaultSortColumnName);

            if (rankColumnIndex === -1 || ageColumnIndex === -1 || defaultSortColumnIndex === -1) {
                throw new Error('Required CSV headers (Rank, Age, All Rounder) not found.');
            }

            const rankDataIndex = rankColumnIndex + 1;
            const ageDataIndex = ageColumnIndex + 1; // Index in the data array is +1

            const expectedColumnCount = headers.length;

            const data = rows.slice(1).map(row => {
                const cells = parseCSVRow(row);
                if (cells.length !== expectedColumnCount) {
                    return null;
                }
                const dataRow = [null];
                cells.forEach(cell => {
                    const num = Number(cell);
                    dataRow.push(isNaN(num) ? cell : num);
                });
                return dataRow;
            })
            .filter(row => row !== null);

            const allData = data;

            // --- RANK FILTER POPULATION ---
            if (rankColumnIndex >= 0) {
                const allRankValues = allData.map(row => String(row[rankDataIndex]));
                const uniqueRankValues = [...new Set(allRankValues)]
                    .filter(rank => RANK_ORDER.includes(rank))
                    .sort((a, b) => RANK_ORDER.indexOf(a) - RANK_ORDER.indexOf(b));

                uniqueRankValues.forEach(rank => {
                    const option = document.createElement('option');
                    option.value = rank;
                    option.text = rank;
                    rankFilterSelect.appendChild(option);
                });

                // Attach event listener for RANK FILTER
                rankFilterSelect.addEventListener('change', () => applyCombinedFilter(allData, rankDataIndex, ageDataIndex));
            }

            // --- NEW AGE FILTER POPULATION ---
            if (ageColumnIndex >= 0) {
                const allAgeValues = allData.map(row => String(row[ageDataIndex]));
                const uniqueAgeValues = [...new Set(allAgeValues)].sort(); // Sort age categories alphabetically/numerically

                uniqueAgeValues.forEach(age => {
                    const option = document.createElement('option');
                    option.value = age;
                    option.text = age;
                    ageFilterSelect.appendChild(option);
                });

                // Attach event listener for AGE FILTER
                ageFilterSelect.addEventListener('change', () => applyCombinedFilter(allData, rankDataIndex, ageDataIndex));
            }
            // ------------------------------------

            container.innerHTML = '';

            const columnObjects = headers.map(header => {
                if (header === 'All Rounder') {
                    return { name: header, width: '70px' };
                }
                return { name: header };
            });

            columnObjects.unshift({
                name: '#',
                width: '30px',
                sort: false,
            });

            gridInstance = new gridjs.Grid({
                columns: columnObjects,
                data: allData,
                search: true,
                autoWidth: true,
                sort: {
                    enabled: true,
                    index: defaultSortColumnIndex >= 0 ? (defaultSortColumnIndex + 1) : 2,
                    direction: -1
                },
                pagination: {
                    limit: 300
                },
            }).render(container);
            const gridSearchPlaceholder = document.getElementById('gridjs-search-placeholder');
            const gridSearchElement = container.querySelector('.gridjs-search');

            if (gridSearchElement) {
                gridSearchPlaceholder.appendChild(gridSearchElement);
            }
        })
        .catch(error => {
            console.error('Error fetching or parsing data:', error);
            container.innerHTML = 'Error loading leaderboard. Wait a moment and then try refreshing.';
        });
</script>
